<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Gabe's Portfolio</title>
    <link rel="icon" type="image/x-icon" href="Assets/Images/General/Flamingo.webp">
    <style>
        /* General resets */
        body, html {
            background-blend-mode: color;
            background: black;
            margin: 0;
            padding: 0;
            overflow-y: auto;
            overflow-x: hidden;
            font-family: Arial, sans-serif;
            z-index: -2;
        }

        /* Fullscreen Canvas */
        #glCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Content Container */
        .content {
            position: relative;
            z-index: 1; /* Ensures content is on top of the canvas */
            text-align: center;
            padding: 20px;
            color: white;
        }


        h1 {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<canvas id="glCanvas"></canvas>
<!-- Fullscreen Shader Background 
<div class="gradient-rect gradient-left"></div>
<div class="gradient-rect gradient-right"></div>
<div  class="gradient-rect gradient-bottom"></div>
-->


<!-- Content -->
<div class="content">
 
    
    <div>
        <div style = "margin-top: 680px">
            <button onclick="loadNewShader()" class="custom-button" >Shake things up?
            </button>
            <br>
            <br>
            <div class = "icon-button-container">
            <button onclick="window.open('https://github.com/FlamingoeZpZ')" class = "icon-button">
                <img src = "Assets/Images/General/GitHub.webp" alt = "Github" class = "button-icon">
            </button>

            <button onclick="window.open('https://www.youtube.com/@gabek5760')" class = "icon-button">
                <img src = "Assets/Images/General/Youtube.webp" alt = "Youtube" class = "button-icon">
            </button>

            <button onclick="window.open('https://www.linkedin.com/in/gabe-kotton-b21050245/')" class = "icon-button">
                <img src = "Assets/Images/General/Linkedin.webp" alt = "Github" class = "button-icon">
            </button>

            <button onclick="window.open('https://flamingoezpz.itch.io/')" class = "icon-button">
                <img src = "Assets/Images/General/Itch.webp" alt = "Github" class = "button-icon">
            </button>
            </div>
            <br>
            <h1>Projects</h1>
        </div>
        <h2>Java | Processing</h2>
        <div class = "gallery">
            <div class = "gallery-item" onclick="window.open('Projects/Processing%20Java/Sheep%20Herder/SheepHerder.html')">
                
                <div class = "gallery-text">
                <text-a>Sheep Herder | Made for RP4K |</text-a>
                <text-link>Play In Browser</text-link>
                </div>
                
                <img src="Projects/Processing%20Java/Sheep%20Herder/Resources/Cover.webp"   alt="Failed To Load Resources">
                <video loop autoplay>
                    <source src="Projects/Processing%20Java/Sheep%20Herder/Resources/Hover.webm" type="video/webm">
                    Your browser does not support WebM.
                </video>
            </div>
            <div class = "gallery-item" onclick="window.open('Projects/Processing%20Java/Toadal%20Chaos/ToadalChaos.html')">
                <div class = "gallery-text">
                <text-a>Toadal Chaos | Made for RP4K |</text-a>
                <text-link>Play In Browser</text-link>
                </div>
                <img src="Projects/Processing%20Java/Toadal%20Chaos/Resources/Cover.webp"   alt="Failed To Load Resources">
                <video loop autoplay >
                    <source src="Projects/Processing%20Java/Toadal%20Chaos/Resources/Hover.webm" type="video/webm">
                    Your browser does not support WebM.
                </video>
            </div>
            <div class = "gallery-item" onclick="window.open('Projects/Processing%20Java/Polar%20Peril/PolarPeril.html')">
                <div class = "gallery-text">
                <text-a>Polar Peril 2 | Made for RP4K |</text-a>
                <text-link>Play In Browser</text-link>
                </div>
                <img src="Projects/Processing%20Java/Polar%20Peril/Resources/Cover.webp"   alt="Failed To Load Resources">
                <video loop autoplay >
                    <source src="Projects/Processing%20Java/Polar%20Peril/Resources/Hover.webm" type="video/webm">
                    Your browser does not support WebM.
                </video>
            </div>
    
        </div>
    </div>
    <br>
    <div>
        <h2>Created by Gabe Kotton</h2>
        <div class = "icon-button-container">
        <button onclick="window.open('https://github.com/FlamingoeZpZ')" class = "icon-button">
            <img src = "Assets/Images/General/GitHub.webp" alt = "Github" class = "button-icon">
        </button>

        <button onclick="window.open('https://www.youtube.com/@gabek5760')" class = "icon-button">
            <img src = "Assets/Images/General/Youtube.webp" alt = "Youtube" class = "button-icon">
        </button>

        <button onclick="window.open('https://www.linkedin.com/in/gabe-kotton-b21050245/')" class = "icon-button">
            <img src = "Assets/Images/General/Linkedin.webp" alt = "Github" class = "button-icon">
        </button>

        <button onclick="window.open('https://flamingoezpz.itch.io/')" class = "icon-button">
            <img src = "Assets/Images/General/Itch.webp" alt = "Github" class = "button-icon">
        </button>
        </div>
    </div>
    <!--<button id="loadShaderButton">Load Random Secondary Shader</button>-->

</div>



<!-- Shader Script (Mostly GPT generated because my JS is weak)-->
<script>
    const secondaryShaders = [
        //"Constant",
        //"Bubbles",
        "Stars",
    ];
    
    let id = -1;

    async function loadShaderSource(url) {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error(`Failed to load shader: ${response.statusText}`);
        }
        return await response.text();
    }

    async function chooseRandomShader() {
        let newId = Math.floor(Math.random() * secondaryShaders.length);
        if(id === newId) newId = (newId + 1)%secondaryShaders.length;
        return await loadShader(newId);
    }

    async function loadNextShader()
    {
        return await loadShader((id + 1)%secondaryShaders.length)
    }
    
    async function loadShader(declared) 
    {
        id = declared;
        const shader = secondaryShaders[id];
        console.log('Assets/Shaders/' + shader + '.frag');
        return await loadShaderSource('Assets/Shaders/' + shader + '.frag');
    }

    async function main() {
        const canvas = document.getElementById("glCanvas");
        const gl = canvas.getContext("webgl");
        
        if (!gl) {
            alert("WebGL not supported!");
            return;
        }

        async function loadNewShader() {
            // Cleanup old shaders and program
            if (program) {
                gl.useProgram(null);
                gl.deleteProgram(program);
            }
            if (fragmentShader) {
                gl.deleteShader(fragmentShader);
            }

            const newFragmentShaderSource = await loadNextShader();
            fragmentShader = compileShader(gl, newFragmentShaderSource, gl.FRAGMENT_SHADER);
            if (!fragmentShader) return;

            program = gl.createProgram();
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);

            if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
                console.error("Program failed to link:", gl.getProgramInfoLog(program));
                return;
            }

            gl.useProgram(program);

            // Update attribute/uniform locations
            positionLocation = gl.getAttribLocation(program, "a_position");
            resolutionLocation = gl.getUniformLocation(program, "u_resolution");
            timeLocation = gl.getUniformLocation(program, "u_time");
        }

        // Expose to window so HTML button can call it
        window.loadNewShader = loadNewShader;

        window.addEventListener("beforeunload", () => {
            if (gl) {
                if (program) {
                    gl.useProgram(null);
                    gl.deleteProgram(program);
                }
                if (fragmentShader) {
                    gl.deleteShader(fragmentShader);
                }
                if (vertexShader) {
                    gl.deleteShader(vertexShader);
                }
            }
        });
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);

        // Vertex Shader Source
        const vertexShaderSource = `
        attribute vec2 a_position;
        void main() {
            gl_Position = vec4(a_position, 0.0, 1.0);
        }
    `;

 

        // Compile Shader Helper
        function compileShader(gl, source, type) {
            const shader = gl.createShader(type);
            gl.shaderSource(shader, source);
            gl.compileShader(shader);
            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                console.error(gl.getShaderInfoLog(shader));
                return null;
            }
            return shader;
        }

        
        
        // Load Fragment Shader Source from External File
        let fragmentShaderSource = await chooseRandomShader();
        
        // Compile Shaders
        const vertexShader = compileShader(gl, vertexShaderSource, gl.VERTEX_SHADER);
        let fragmentShader = compileShader(gl, fragmentShaderSource, gl.FRAGMENT_SHADER);

        let program = gl.createProgram();

        let positionLocation = 0;
        let resolutionLocation = 0;
        let timeLocation = 0;
        
        
        createProgram();
        function createProgram()
        {
            // Create Program
            program = gl.createProgram();
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);
            gl.useProgram(program);

            createLocations();
        }
        

        function createLocations()
        {
             positionLocation = gl.getAttribLocation(program, "a_position");
            
            // Uniforms
             resolutionLocation = gl.getUniformLocation(program, "u_resolution");
             timeLocation = gl.getUniformLocation(program, "u_time");
        }
        
        
        // Fullscreen Quad Setup
        const positionBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
            -1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, 1
        ]), gl.STATIC_DRAW);



        function render(time) {
            gl.enableVertexAttribArray(positionLocation);
            gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

            const displayWidth = canvas.clientWidth;
            const displayHeight = canvas.clientHeight;

            // Check if the canvas size needs to be updated
            if (canvas.width !== displayWidth || canvas.height !== displayHeight) {
                canvas.width = displayWidth;
                canvas.height = displayHeight;
                gl.viewport(0, 0, canvas.width, canvas.height); // Update the viewport
            }
            
            gl.uniform2f(resolutionLocation, canvas.width, canvas.height);
            gl.uniform1f(timeLocation, time * 0.001);

            gl.drawArrays(gl.TRIANGLES, 0, 6);
            requestAnimationFrame(render);
        }
        requestAnimationFrame(render);
    }


    
    main().catch(console.error);
</script>


</body>
</html>
